# streamMorphoDPID <- "DP4.00131.001"
# dataFromAPI <- zipsByProduct(streamMorphoDPID,site,package="expanded",check.size=FALSE)
# filepath <- "C:/Users/kcawley/Desktop/test/filesToStack00131/"
# stackByTable(filepath=filepath, folder = TRUE)
#Use the new function here once we have the data in the new ECS zip packages
#HOPB processing code
# filepath <- "C:/Users/kcawley/Desktop/test/"
# surveyPtsDF <- read.table(paste0(filepath,"HOPB_surveyPts_20170921.csv"),sep = ",",stringsAsFactors = FALSE, header = TRUE)
# siteID <- "HOPB"
# surveyDate <- "2017-09-21T16:00"
#load packages
require(rgdal)
library(rgdal)
library(plotly)
#NEON Domain number (ex: D01).
domainID<-'D04'
#Four-digit NEON site code (ex: HOPB).
siteID <- 'GUIL'
#The end date of the geomorphology survey (YYYYMMDD).
surveyDate<-'20180129'
#Stipulate 4-digit site code, underscore, and survey year (ex: HOPB_2017).
surveyID <- "GUIL_2018"
#Queues a directory that contains file paths for each site per survey date.
siteDirectory<-read.csv('N:/Science/AQU/Geomorphology_Survey_Data/inputDirectory.csv',head=T,sep=",",stringsAsFactors = F)
#Creates dataframe that contains survey data.
filePath <- siteDirectory$filePath[which(siteDirectory$surveyID==surveyID)]
surveyShapefileName <- siteDirectory$surveyShapefileName[which(siteDirectory$surveyID==surveyID)]
surveyPts <- readOGR(filePath,surveyShapefileName)
surveyPtsDF <- as.data.frame(surveyPts)
#Working directory where files will be output.
wdir<-paste('C:/Users/nharrison/Documents/GitHub/landWaterSoilIPT/streamMorpho/ScienceProcessingCode/R_Metrics',siteID,'Raw_Data',sep="/")
#wdir<-paste('C:/Users/kcawley/Documents/GitHub/landWaterSoilIPT/streamMorpho/ScienceProcessingCode/R_Metrics',siteID,'Raw_Data',sep="/")
#Creates dataframe of all points associated with transect DSC1.
dischargePointsXS1<-subset(surveyPtsDF,mapCode=="Transect_DSC1_New")
dischargePointsXS1<-dischargePointsXS1[order(dischargePointsXS1$N),]
rownames(dischargePointsXS1)<-seq(length=nrow(dischargePointsXS1))
#Sets plot1 settings.
xAxisTitle1<-list(title="Easting (m)",zeroline=FALSE)
yAxisTitle1<-list(title="Northing  (m)",zeroline=FALSE)
font<-list(size=12,color='black')
#Plot the cross section by easting and northing data.
plot_ly(data=dischargePointsXS1,x=~E, y=~N, name='Easting vs Northing', type='scatter', mode='markers', text=~name)%>%
layout(title = siteID, xaxis=xAxisTitle1, yaxis=yAxisTitle1)
#Manually select NorthStart and EastStart coordinates
dischargeXS1NorthStart<-dischargePointsXS1$N[1]
dischargeXS1EastStart<-dischargePointsXS1$E[1]
#Assigns a raw Distance value to each point relative to the NorthStart and EastStart coordinates.
for(i in 1:(length(dischargePointsXS1$name))){
dischargeXS1PointN<-dischargePointsXS1$N[i]
dischargeXS1PointE<-dischargePointsXS1$E[i]
dischargePointsXS1$DistanceRaw[i]<-sqrt(((dischargeXS1PointN-dischargeXS1NorthStart)^2)+((dischargeXS1PointE-dischargeXS1EastStart)^2))
}
#To manually select ReferenceDistance:
dischargeXS1ReferenceDistance<-dischargePointsXS1$DistanceRaw[1]
#Sets Horizontal adjustment value based on reference point coordinate.
dischargeXS1HorizontalAdjust<-0-dischargeXS1ReferenceDistance
#Transforms raw distance to adjusted distance based on reference distance point.
for(i in 1:(length(dischargePointsXS1$name))){
dischargePointsXS1$DistanceAdj[i]<-dischargePointsXS1$DistanceRaw[i]+dischargeXS1HorizontalAdjust
}
#Plot the cross-section again to check reference values and ensure that the profile is being viewed from left to right bank.
#Sets plot2 settings.
xAxisTitle2<-list(title="Distance (m)",zeroline=FALSE)
yAxisTitle2<-list(title="Elevation  (m)",zeroline=FALSE)
font<-list(size=12,color='black')
#Plot the cross section by easting and northing data.
plot_ly(data=dischargePointsXS1,x=~DistanceAdj, y=~H, name='Distance vs Elevation',
type='scatter', mode='lines+markers', text=~name)%>%
layout(title = siteID, xaxis=xAxisTitle2, yaxis=yAxisTitle2)
#Calculates the bankfull width.
DSCXS1Bankfull<-abs((dischargePointsXS1$DistanceAdj[grepl("RBF",dischargePointsXS1$name)])-(dischargePointsXS1$DistanceAdj[grepl("LBF",dischargePointsXS1$name)]))
#Creates dataframe of staff gauge points.
staffGaugePoints=subset(surveyPtsDF,surveyPtsDF$mapCode=="Gauge")
staffGaugePoints<-staffGaugePoints[order(staffGaugePoints$N),]
rownames(staffGaugePoints)<-seq(length=nrow(staffGaugePoints))
View(staffGaugePoints)
staffGaugePoints=subset(surveyPtsDF,surveyPtsDF$mapCode=="Gauge")
staffGaugePoints<-staffGaugePoints[order(staffGaugePoints$N),]
rownames(staffGaugePoints)<-seq(length=nrow(staffGaugePoints))
View(staffGaugePoints)
View(surveyPtsDF)
# library(neonUtilities)
# #For use with the API functionality
# dataDir <- "API"
# siteID <- "HOPB"
#
# streamMorphoDPID <- "DP4.00131.001"
# dataFromAPI <- zipsByProduct(streamMorphoDPID,site,package="expanded",check.size=FALSE)
# filepath <- "C:/Users/kcawley/Desktop/test/filesToStack00131/"
# stackByTable(filepath=filepath, folder = TRUE)
#Use the new function here once we have the data in the new ECS zip packages
#HOPB processing code
# filepath <- "C:/Users/kcawley/Desktop/test/"
# surveyPtsDF <- read.table(paste0(filepath,"HOPB_surveyPts_20170921.csv"),sep = ",",stringsAsFactors = FALSE, header = TRUE)
# siteID <- "HOPB"
# surveyDate <- "2017-09-21T16:00"
#load packages
require(rgdal)
library(rgdal)
library(plotly)
#NEON Domain number (ex: D01).
domainID<-'D04'
#Four-digit NEON site code (ex: HOPB).
siteID <- 'GUIL'
#The end date of the geomorphology survey (YYYYMMDD).
surveyDate<-'20170825'
#Stipulate 4-digit site code, underscore, and survey year (ex: HOPB_2017).
surveyID <- "GUIL_2017"
#Queues a directory that contains file paths for each site per survey date.
siteDirectory<-read.csv('N:/Science/AQU/Geomorphology_Survey_Data/inputDirectory.csv',head=T,sep=",",stringsAsFactors = F)
#Creates dataframe that contains survey data.
filePath <- siteDirectory$filePath[which(siteDirectory$surveyID==surveyID)]
surveyShapefileName <- siteDirectory$surveyShapefileName[which(siteDirectory$surveyID==surveyID)]
surveyPts <- readOGR(filePath,surveyShapefileName)
surveyPtsDF <- as.data.frame(surveyPts)
#Working directory where files will be output.
wdir<-paste('C:/Users/nharrison/Documents/GitHub/landWaterSoilIPT/streamMorpho/ScienceProcessingCode/R_Metrics',siteID,'Raw_Data',sep="/")
#wdir<-paste('C:/Users/kcawley/Documents/GitHub/landWaterSoilIPT/streamMorpho/ScienceProcessingCode/R_Metrics',siteID,'Raw_Data',sep="/")
#Creates dataframe of all points associated with transect DSC1.
dischargePointsXS1<-subset(surveyPtsDF,mapCode=="Transect_DSC1")
dischargePointsXS1<-dischargePointsXS1[order(dischargePointsXS1$E),]
rownames(dischargePointsXS1)<-seq(length=nrow(dischargePointsXS1))
#Sets plot1 settings.
xAxisTitle1<-list(title="Easting (m)",zeroline=FALSE)
yAxisTitle1<-list(title="Northing  (m)",zeroline=FALSE)
font<-list(size=12,color='black')
#Plot the cross section by easting and northing data.
plot_ly(data=dischargePointsXS1,x=~E, y=~N, name='Easting vs Northing', type='scatter', mode='markers', text=~name)%>%
layout(title = siteID, xaxis=xAxisTitle1, yaxis=yAxisTitle1)
#Manually select NorthStart and EastStart coordinates
dischargeXS1NorthStart<-dischargePointsXS1$N[30]
dischargeXS1EastStart<-dischargePointsXS1$E[30]
#Assigns a raw Distance value to each point relative to the NorthStart and EastStart coordinates.
for(i in 1:(length(dischargePointsXS1$name))){
dischargeXS1PointN<-dischargePointsXS1$N[i]
dischargeXS1PointE<-dischargePointsXS1$E[i]
dischargePointsXS1$DistanceRaw[i]<-sqrt(((dischargeXS1PointN-dischargeXS1NorthStart)^2)+((dischargeXS1PointE-dischargeXS1EastStart)^2))
}
#To manually select ReferenceDistance:
dischargeXS1ReferenceDistance<-dischargePointsXS1$DistanceRaw[30]
#Sets Horizontal adjustment value based on reference point coordinate.
dischargeXS1HorizontalAdjust<-0-dischargeXS1ReferenceDistance
#Transforms raw distance to adjusted distance based on reference distance point.
for(i in 1:(length(dischargePointsXS1$name))){
dischargePointsXS1$DistanceAdj[i]<-dischargePointsXS1$DistanceRaw[i]+dischargeXS1HorizontalAdjust
}
#Plot the cross-section again to check reference values and ensure that the profile is being viewed from left to right bank.
#Sets plot2 settings.
xAxisTitle2<-list(title="Distance (m)",zeroline=FALSE)
yAxisTitle2<-list(title="Elevation  (m)",zeroline=FALSE)
font<-list(size=12,color='black')
#Plot the cross section by easting and northing data.
plot_ly(data=dischargePointsXS1,x=~DistanceAdj, y=~H, name='Distance vs Elevation',
type='scatter', mode='lines+markers', text=~name)%>%
layout(title = siteID, xaxis=xAxisTitle2, yaxis=yAxisTitle2)
#Calculates the bankfull width.
DSCXS1Bankfull<-abs((dischargePointsXS1$DistanceAdj[grepl("RBF",dischargePointsXS1$name)])-(dischargePointsXS1$DistanceAdj[grepl("LBF",dischargePointsXS1$name)]))
#Creates dataframe of staff gauge points.
staffGaugePoints=subset(surveyPtsDF,surveyPtsDF$mapCode=="Gauge")
staffGaugePoints<-staffGaugePoints[order(staffGaugePoints$N),]
rownames(staffGaugePoints)<-seq(length=nrow(staffGaugePoints))
#Set meter mark where the staff gauge was shot in and the name of the staff gauge point:
#Recorded in field data
staffGaugeMeterMark<-1.00
staffGaugeElevation <- staffGaugePoints$H[grepl("SP_1.00m",staffGaugePoints$name)]
View(staffGaugePoints)
# library(neonUtilities)
# #For use with the API functionality
# dataDir <- "API"
# siteID <- "HOPB"
#
# streamMorphoDPID <- "DP4.00131.001"
# dataFromAPI <- zipsByProduct(streamMorphoDPID,site,package="expanded",check.size=FALSE)
# filepath <- "C:/Users/kcawley/Desktop/test/filesToStack00131/"
# stackByTable(filepath=filepath, folder = TRUE)
#Use the new function here once we have the data in the new ECS zip packages
#HOPB processing code
# filepath <- "C:/Users/kcawley/Desktop/test/"
# surveyPtsDF <- read.table(paste0(filepath,"HOPB_surveyPts_20170921.csv"),sep = ",",stringsAsFactors = FALSE, header = TRUE)
# siteID <- "HOPB"
# surveyDate <- "2017-09-21T16:00"
#load packages
require(rgdal)
library(rgdal)
library(plotly)
#NEON Domain number (ex: D01).
domainID<-'D04'
#Four-digit NEON site code (ex: HOPB).
siteID <- 'GUIL'
#The end date of the geomorphology survey (YYYYMMDD).
surveyDate<-'20180129'
#Stipulate 4-digit site code, underscore, and survey year (ex: HOPB_2017).
surveyID <- "GUIL_2018"
#Queues a directory that contains file paths for each site per survey date.
siteDirectory<-read.csv('N:/Science/AQU/Geomorphology_Survey_Data/inputDirectory.csv',head=T,sep=",",stringsAsFactors = F)
#Creates dataframe that contains survey data.
filePath <- siteDirectory$filePath[which(siteDirectory$surveyID==surveyID)]
surveyShapefileName <- siteDirectory$surveyShapefileName[which(siteDirectory$surveyID==surveyID)]
surveyPts <- readOGR(filePath,surveyShapefileName)
surveyPtsDF <- as.data.frame(surveyPts)
#Working directory where files will be output.
wdir<-paste('C:/Users/nharrison/Documents/GitHub/landWaterSoilIPT/streamMorpho/ScienceProcessingCode/R_Metrics',siteID,'Raw_Data',sep="/")
#wdir<-paste('C:/Users/kcawley/Documents/GitHub/landWaterSoilIPT/streamMorpho/ScienceProcessingCode/R_Metrics',siteID,'Raw_Data',sep="/")
#Creates dataframe of all points associated with transect DSC1.
dischargePointsXS1<-subset(surveyPtsDF,mapCode=="Transect_DSC1_New")
dischargePointsXS1<-dischargePointsXS1[order(dischargePointsXS1$N),]
rownames(dischargePointsXS1)<-seq(length=nrow(dischargePointsXS1))
#Sets plot1 settings.
xAxisTitle1<-list(title="Easting (m)",zeroline=FALSE)
yAxisTitle1<-list(title="Northing  (m)",zeroline=FALSE)
font<-list(size=12,color='black')
#Plot the cross section by easting and northing data.
plot_ly(data=dischargePointsXS1,x=~E, y=~N, name='Easting vs Northing', type='scatter', mode='markers', text=~name)%>%
layout(title = siteID, xaxis=xAxisTitle1, yaxis=yAxisTitle1)
#Manually select NorthStart and EastStart coordinates
dischargeXS1NorthStart<-dischargePointsXS1$N[1]
dischargeXS1EastStart<-dischargePointsXS1$E[1]
#Assigns a raw Distance value to each point relative to the NorthStart and EastStart coordinates.
for(i in 1:(length(dischargePointsXS1$name))){
dischargeXS1PointN<-dischargePointsXS1$N[i]
dischargeXS1PointE<-dischargePointsXS1$E[i]
dischargePointsXS1$DistanceRaw[i]<-sqrt(((dischargeXS1PointN-dischargeXS1NorthStart)^2)+((dischargeXS1PointE-dischargeXS1EastStart)^2))
}
#To manually select ReferenceDistance:
dischargeXS1ReferenceDistance<-dischargePointsXS1$DistanceRaw[1]
#Sets Horizontal adjustment value based on reference point coordinate.
dischargeXS1HorizontalAdjust<-0-dischargeXS1ReferenceDistance
#Transforms raw distance to adjusted distance based on reference distance point.
for(i in 1:(length(dischargePointsXS1$name))){
dischargePointsXS1$DistanceAdj[i]<-dischargePointsXS1$DistanceRaw[i]+dischargeXS1HorizontalAdjust
}
#Plot the cross-section again to check reference values and ensure that the profile is being viewed from left to right bank.
#Sets plot2 settings.
xAxisTitle2<-list(title="Distance (m)",zeroline=FALSE)
yAxisTitle2<-list(title="Elevation  (m)",zeroline=FALSE)
font<-list(size=12,color='black')
#Plot the cross section by easting and northing data.
plot_ly(data=dischargePointsXS1,x=~DistanceAdj, y=~H, name='Distance vs Elevation',
type='scatter', mode='lines+markers', text=~name)%>%
layout(title = siteID, xaxis=xAxisTitle2, yaxis=yAxisTitle2)
#Calculates the bankfull width.
DSCXS1Bankfull<-abs((dischargePointsXS1$DistanceAdj[grepl("RBF",dischargePointsXS1$name)])-(dischargePointsXS1$DistanceAdj[grepl("LBF",dischargePointsXS1$name)]))
#Creates dataframe of staff gauge points.
staffGaugePoints=subset(surveyPtsDF,surveyPtsDF$mapCode=="Gauge")
staffGaugePoints<-staffGaugePoints[order(staffGaugePoints$N),]
rownames(staffGaugePoints)<-seq(length=nrow(staffGaugePoints))
#Set meter mark where the staff gauge was shot in and the name of the staff gauge point:
#Recorded in field data
staffGaugeMeterMark<-1.05
staffGaugeElevation <- staffGaugePoints$H[grepl("SP_1.05M_TEMP",staffGaugePoints$name)]
#Converts discharge XS1 transect point elevations to gauge height (rounded to 2 digits).
dischargePointsXS1$gaugeHeight<-dischargePointsXS1$H - (staffGaugeElevation - staffGaugeMeterMark)
dischargePointsXS1$gaugeHeight<-round(dischargePointsXS1$gaugeHeight,digits=2)
#Assigns a unique to each measurement for plot viewing purposes.
dischargePointsXS1$ID<-c(1:length(dischargePointsXS1$name))
dischargePointsXS1 <- dischargePointsXS1[order(dischargePointsXS1$DistanceAdj),]
#invisible(dev.new(noRStudioGD = TRUE))
#Sets plot3 settings.
xAxisTitle3<-list(title="Distance (m)",zeroline=FALSE) #If you don't want auto axis range: , range=c(-5,15)
yAxisTitle3<-list(title="Gauge Height  (m)",zeroline=FALSE)
font<-list(size=12,color='black')
#Plot the cross section by distance and gauge height.  Note whether or not red line is below thalweg.
plot_ly(data=dischargePointsXS1,x=~DistanceAdj, y=~gaugeHeight, name='Distance vs. Gauge Height',
type='scatter', mode='markers+lines', text=~name)%>%
add_trace(y= 0,name = 'Gauge Height = 0.00m',mode='lines',line = list(color = 'red', width = 2,
dash='dash')) %>%
layout(title = siteID, xaxis=xAxisTitle3, yaxis=yAxisTitle3)
View(dischargePointsXS1)
#Calculates gaugeHeight at LB and RB bankfull:
gaugeHeightLBF<-dischargePointsXS1$gaugeHeight[grepl("LBF",dischargePointsXS1$name)]
gaugeHeightRBF<-dischargePointsXS1$gaugeHeight[grepl("RBF",dischargePointsXS1$name)]
#Asseses whether negative stage is present in the discharge cross-section
negativeStage<-any(dischargePointsXS1$gaugeHeight<0)
if(negativeStage==TRUE){
execpart<-TRUE
}else{exetpart<-FALSE}
#This section will only run if there are negative values in the gauge height column.
if(execpart){
#Determines the lowest elevation of the discharge cross-section, assumed to be the thalweg.
dischargeXS1THL<-min(dischargePointsXS1$H)
#Calculates the elevation of the 0.00 meter mark of the staff gauge.
staffGaugeZeroElevation<-(staffGaugePoints$H[staffGaugePoints$name=="SP_1.05M_TEMP"])-staffGaugeMeterMark
#Calculates the difference between the staff gauge 0.00m mark elevation and the discharge thalweg elevation.
gaugeZeroQElevDiff<--as.numeric(dischargeXS1THL-staffGaugeZeroElevation)
#Offsets the elevation of the gauge heights by this difference, rounds to two digits.
dischargePointsXS1$gaugeOffsetElevation<-dischargePointsXS1$H + (gaugeZeroQElevDiff)
dischargePointsXS1$gaugeOffsetElevation<-round(dischargePointsXS1$gaugeOffsetElevation,digits=2)
#Offsets the gauge heights by the offset elevation, rounds to two digits.
dischargePointsXS1$gaugeHeightOffset<-dischargePointsXS1$gaugeOffsetElevation - (staffGaugeElevation - staffGaugeMeterMark)
dischargePointsXS1$gaugeHeightOffset<-round(dischargePointsXS1$gaugeHeightOffset,digits=2)
#Plots discharge XS1 transect point distances vs gaugeHeightOffset.  Red line should be at the thalweg.
plot_ly(data=dischargePointsXS1,x=~DistanceAdj, y=~gaugeHeightOffset, name='Distance vs. Gauge Height', type='scatter', mode='markers+lines', text=~name)%>%
add_trace(y= 0,name = 'Gauge Height = 0.00m',mode='lines',line = list(color = 'red', width = 2, dash='dash')) %>%
layout(title = siteID, xaxis=xAxisTitle2, yaxis=yAxisTitle2)
}else{"There are no negative gauge height values in discharge XS1.  There is no need for correction."}
View(surveyPtsDF)
# library(neonUtilities)
# #For use with the API functionality
# dataDir <- "API"
# siteID <- "HOPB"
#
# streamMorphoDPID <- "DP4.00131.001"
# dataFromAPI <- zipsByProduct(streamMorphoDPID,site,package="expanded",check.size=FALSE)
# filepath <- "C:/Users/kcawley/Desktop/test/filesToStack00131/"
# stackByTable(filepath=filepath, folder = TRUE)
#Use the new function here once we have the data in the new ECS zip packages
#HOPB processing code
# filepath <- "C:/Users/kcawley/Desktop/test/"
# surveyPtsDF <- read.table(paste0(filepath,"HOPB_surveyPts_20170921.csv"),sep = ",",stringsAsFactors = FALSE, header = TRUE)
# siteID <- "HOPB"
# surveyDate <- "2017-09-21T16:00"
#load packages
require(rgdal)
library(rgdal)
library(plotly)
#NEON Domain number (ex: D01).
domainID<-'D04'
#Four-digit NEON site code (ex: HOPB).
siteID <- 'GUIL'
#The end date of the geomorphology survey (YYYYMMDD).
surveyDate<-'20180129'
#Stipulate 4-digit site code, underscore, and survey year (ex: HOPB_2017).
surveyID <- "GUIL_2018"
#Queues a directory that contains file paths for each site per survey date.
siteDirectory<-read.csv('N:/Science/AQU/Geomorphology_Survey_Data/inputDirectory.csv',head=T,sep=",",stringsAsFactors = F)
#Creates dataframe that contains survey data.
filePath <- siteDirectory$filePath[which(siteDirectory$surveyID==surveyID)]
surveyShapefileName <- siteDirectory$surveyShapefileName[which(siteDirectory$surveyID==surveyID)]
surveyPts <- readOGR(filePath,surveyShapefileName)
surveyPtsDF <- as.data.frame(surveyPts)
#Working directory where files will be output.
wdir<-paste('C:/Users/nharrison/Documents/GitHub/landWaterSoilIPT/streamMorpho/ScienceProcessingCode/R_Metrics',siteID,'Raw_Data',sep="/")
#wdir<-paste('C:/Users/kcawley/Documents/GitHub/landWaterSoilIPT/streamMorpho/ScienceProcessingCode/R_Metrics',siteID,'Raw_Data',sep="/")
#Creates dataframe of all points associated with transect DSC1.
dischargePointsXS1<-subset(surveyPtsDF,mapCode=="Transect_DSC1_Original")
dischargePointsXS1<-dischargePointsXS1[order(dischargePointsXS1$N),]
rownames(dischargePointsXS1)<-seq(length=nrow(dischargePointsXS1))
#Sets plot1 settings.
xAxisTitle1<-list(title="Easting (m)",zeroline=FALSE)
yAxisTitle1<-list(title="Northing  (m)",zeroline=FALSE)
font<-list(size=12,color='black')
#Plot the cross section by easting and northing data.
plot_ly(data=dischargePointsXS1,x=~E, y=~N, name='Easting vs Northing', type='scatter', mode='markers', text=~name)%>%
layout(title = siteID, xaxis=xAxisTitle1, yaxis=yAxisTitle1)
#Manually select NorthStart and EastStart coordinates
dischargeXS1NorthStart<-dischargePointsXS1$N[1]
dischargeXS1EastStart<-dischargePointsXS1$E[1]
#Assigns a raw Distance value to each point relative to the NorthStart and EastStart coordinates.
for(i in 1:(length(dischargePointsXS1$name))){
dischargeXS1PointN<-dischargePointsXS1$N[i]
dischargeXS1PointE<-dischargePointsXS1$E[i]
dischargePointsXS1$DistanceRaw[i]<-sqrt(((dischargeXS1PointN-dischargeXS1NorthStart)^2)+((dischargeXS1PointE-dischargeXS1EastStart)^2))
}
#To manually select ReferenceDistance:
dischargeXS1ReferenceDistance<-dischargePointsXS1$DistanceRaw[1]
#Sets Horizontal adjustment value based on reference point coordinate.
dischargeXS1HorizontalAdjust<-0-dischargeXS1ReferenceDistance
#Transforms raw distance to adjusted distance based on reference distance point.
for(i in 1:(length(dischargePointsXS1$name))){
dischargePointsXS1$DistanceAdj[i]<-dischargePointsXS1$DistanceRaw[i]+dischargeXS1HorizontalAdjust
}
#Plot the cross-section again to check reference values and ensure that the profile is being viewed from left to right bank.
#Sets plot2 settings.
xAxisTitle2<-list(title="Distance (m)",zeroline=FALSE)
yAxisTitle2<-list(title="Elevation  (m)",zeroline=FALSE)
font<-list(size=12,color='black')
#Plot the cross section by easting and northing data.
plot_ly(data=dischargePointsXS1,x=~DistanceAdj, y=~H, name='Distance vs Elevation',
type='scatter', mode='lines+markers', text=~name)%>%
layout(title = siteID, xaxis=xAxisTitle2, yaxis=yAxisTitle2)
#Calculates the bankfull width.
DSCXS1Bankfull<-abs((dischargePointsXS1$DistanceAdj[grepl("RBF",dischargePointsXS1$name)])-(dischargePointsXS1$DistanceAdj[grepl("LBF",dischargePointsXS1$name)]))
#Creates dataframe of staff gauge points.
staffGaugePoints=subset(surveyPtsDF,surveyPtsDF$mapCode=="Gauge")
staffGaugePoints<-staffGaugePoints[order(staffGaugePoints$N),]
rownames(staffGaugePoints)<-seq(length=nrow(staffGaugePoints))
View(staffGaugePoints)
#Set meter mark where the staff gauge was shot in and the name of the staff gauge point:
#Recorded in field data
staffGaugeMeterMark<-1.05
staffGaugeElevation <- staffGaugePoints$H[grepl("SP_1.05M_TEMP",staffGaugePoints$name)]
#Converts discharge XS1 transect point elevations to gauge height (rounded to 2 digits).
dischargePointsXS1$gaugeHeight<-dischargePointsXS1$H - (staffGaugeElevation - staffGaugeMeterMark)
dischargePointsXS1$gaugeHeight<-round(dischargePointsXS1$gaugeHeight,digits=2)
#Assigns a unique to each measurement for plot viewing purposes.
dischargePointsXS1$ID<-c(1:length(dischargePointsXS1$name))
dischargePointsXS1 <- dischargePointsXS1[order(dischargePointsXS1$DistanceAdj),]
#invisible(dev.new(noRStudioGD = TRUE))
#Sets plot3 settings.
xAxisTitle3<-list(title="Distance (m)",zeroline=FALSE) #If you don't want auto axis range: , range=c(-5,15)
yAxisTitle3<-list(title="Gauge Height  (m)",zeroline=FALSE)
font<-list(size=12,color='black')
#Plot the cross section by distance and gauge height.  Note whether or not red line is below thalweg.
plot_ly(data=dischargePointsXS1,x=~DistanceAdj, y=~gaugeHeight, name='Distance vs. Gauge Height',
type='scatter', mode='markers+lines', text=~name)%>%
add_trace(y= 0,name = 'Gauge Height = 0.00m',mode='lines',line = list(color = 'red', width = 2,
dash='dash')) %>%
layout(title = siteID, xaxis=xAxisTitle3, yaxis=yAxisTitle3)
#Set meter mark where the staff gauge was shot in and the name of the staff gauge point:
#Recorded in field data
staffGaugeMeterMark<-1.00
staffGaugeElevation <- 994.1744 #the elevation of the staff gauge surveyed in 2017 at the 1.00 meter mark.
#Converts discharge XS1 transect point elevations to gauge height (rounded to 2 digits).
dischargePointsXS1$gaugeHeight<-dischargePointsXS1$H - (staffGaugeElevation - staffGaugeMeterMark)
dischargePointsXS1$gaugeHeight<-round(dischargePointsXS1$gaugeHeight,digits=2)
#Assigns a unique to each measurement for plot viewing purposes.
dischargePointsXS1$ID<-c(1:length(dischargePointsXS1$name))
dischargePointsXS1 <- dischargePointsXS1[order(dischargePointsXS1$DistanceAdj),]
#invisible(dev.new(noRStudioGD = TRUE))
#Sets plot3 settings.
xAxisTitle3<-list(title="Distance (m)",zeroline=FALSE) #If you don't want auto axis range: , range=c(-5,15)
yAxisTitle3<-list(title="Gauge Height  (m)",zeroline=FALSE)
font<-list(size=12,color='black')
#Plot the cross section by distance and gauge height.  Note whether or not red line is below thalweg.
plot_ly(data=dischargePointsXS1,x=~DistanceAdj, y=~gaugeHeight, name='Distance vs. Gauge Height',
type='scatter', mode='markers+lines', text=~name)%>%
add_trace(y= 0,name = 'Gauge Height = 0.00m',mode='lines',line = list(color = 'red', width = 2,
dash='dash')) %>%
layout(title = siteID, xaxis=xAxisTitle3, yaxis=yAxisTitle3)
domainID1 <- 'D04' #NEON Domain number (ex: D01)
siteID1 <- 'GUIL' #Four-digit NEON site code (ex: HOPB)
surveyDate1<-'2017' #The end date of the geomorphology survey (YYYYMMDD)
processedFile1<-'D15_REDB_GEOMORPH_DISCHARGE_XS.csv' #name of the .CSV that contains the post-processed survey data
wdir1<-paste('N:/Science/AQU/Geomorphology_Survey_Data/D04/GUIL_20170825/GUIL_surveyPts_20170825.dbf') #working directory where the file is located on your network.
#wdir<-paste('C:/Users/kcawley/Documents/GitHub/landWaterSoilIPT/streamMorpho/ScienceProcessingCode/R_Metrics',siteID,sep="/")
allData1<-read.csv(file=paste(wdir1,processedFile1,sep="/"),header=TRUE,stringsAsFactors = FALSE)
require(rgdal)
library(rgdal)
library(plotly)
#Queues a directory that contains file paths for each site per survey date.
siteDirectory1<-read.csv('N:/Science/AQU/Geomorphology_Survey_Data/inputDirectory.csv',head=T,sep=",",stringsAsFactors = F)
#NEON Domain number (ex: D01).
domainID1<-'D04'
#Four-digit NEON site code (ex: HOPB).
siteID1<- 'GUIL'
#The end date of the geomorphology survey (YYYYMMDD).
surveyDate1<-'20180129'
#Stipulate 4-digit site code, underscore, and survey year (ex: HOPB_2017).
surveyID1<- "GUIL_2018"
#Creates dataframe1 that contains survey data1.
filePath1 <- siteDirectory1$filePath[which(siteDirectory1$surveyID==surveyID1)]
surveyShapefileName1 <- siteDirectory1$surveyShapefileName[which(siteDirectory1$surveyID==surveyID1)]
surveyPts1 <- readOGR(filePath1,surveyShapefileName1)
surveyPtsDF1 <- as.data.frame(surveyPts1)
View(siteDirectory1)
#NEON Domain number (ex: D01).
domainID2<-'D04'
#Four-digit NEON site code (ex: HOPB).
siteID2<- 'GUIL'
#The end date of the geomorphology survey (YYYYMMDD).
surveyDate2<-'20170825'
#Stipulate 4-digit site code, underscore, and survey year (ex: HOPB_2017).
surveyID2<- "GUIL_2017"
#Creates dataframe1 that contains survey data1.
filePath2 <- siteDirectory1$filePath[which(siteDirectory1$surveyID==surveyID2)]
surveyShapefileName2 <- siteDirectory1$surveyShapefileName[which(siteDirectory1$surveyID==surveyID2)]
surveyPts2 <- readOGR(filePath2,surveyShapefileName2)
surveyPtsDF2 <- as.data.frame(surveyPts2)
View(surveyPtsDF2)
#Creates dataframe of all points associated with transect DSC1.
dischargePointsXS1=subset(surveyPtsDF1,mapCode=="Transect_DSC1")
dischargePointsXS1<-dischargePointsXS1[
with(dischargePointsXS1,order(dischargePointsXS1$N)),
]
rownames(dischargePointsXS1)<-seq(length=nrow(dischargePointsXS1))
dischargePointsXS1$surveyYear<-surveyDate1
View(dischargePointsXS1)
View(surveyPtsDF1)
#Creates dataframe of all points associated with transect DSC1.
dischargePointsXS1=subset(surveyPtsDF1,mapCode=="Transect_DSC1_Original")
dischargePointsXS1<-dischargePointsXS1[
with(dischargePointsXS1,order(dischargePointsXS1$N)),
]
rownames(dischargePointsXS1)<-seq(length=nrow(dischargePointsXS1))
dischargePointsXS1$surveyYear<-surveyDate1
#Creates dataframe of all points associated with transect DSC1.
dischargePointsXS1=subset(surveyPtsDF1,mapCode=="Transect_DSC1_Original")
dischargePointsXS1<-dischargePointsXS1[
with(dischargePointsXS1,order(dischargePointsXS1$E)),
]
rownames(dischargePointsXS1)<-seq(length=nrow(dischargePointsXS1))
dischargePointsXS1$surveyYear<-surveyDate1
#To manually select NorthStart and EastStart coordinates
dischargeXS1NorthStart<-dischargePointsXS1$N[49]
dischargeXS1EastStart<-dischargePointsXS1$E[49]
#Assigns a raw Distance value to each point relative to the NorthStart and EastStart coordinates.
for(i in 1:(length(dischargePointsXS1$name))){
dischargeXS1PointN<-dischargePointsXS1$N[i]
dischargeXS1PointE<-dischargePointsXS1$E[i]
dischargePointsXS1$DistanceRaw[i]<-sqrt(((dischargeXS1PointN-dischargeXS1NorthStart)^2)+((dischargeXS1PointE-dischargeXS1EastStart)^2))
}
#To manually select ReferenceDistance:
dischargeXS1ReferenceDistance<-dischargePointsXS1$DistanceRaw[49]
#Sets Horizontal adjustment value based on reference point coordinate.
dischargeXS1HorizontalAdjust<-0-dischargeXS1ReferenceDistance
#Transforms raw distance to adjusted distance based on reference distance point.
for(i in 1:(length(dischargePointsXS1$name))){
dischargePointsXS1$DistanceAdj[i]<-dischargePointsXS1$DistanceRaw[i]+dischargeXS1HorizontalAdjust
}
xAxisTitle1<-list(title="Elevation (m)",zeroline=FALSE)
yAxisTitle1<-list(title="Distance  (m)",zeroline=FALSE)
font<-list(size=12,color='black')
#Sets plot1 settings.
xAxisTitle1<-list(title="Elevation (m)",zeroline=FALSE)
yAxisTitle1<-list(title="Distance  (m)",zeroline=FALSE)
font<-list(size=12,color='black')
#Plot the cross section by easting and northing data.
plot_ly(data=dischargePointsXS1,x=~DistanceAdj, y=~N, name='Distance vs. Elevation', type='scatter', mode='lines+markers', text=~name)%>%
layout(title = siteID1, xaxis=xAxisTitle1, yaxis=yAxisTitle1)
#Plot the cross section by easting and northing data.
plot_ly(data=dischargePointsXS1,x=~DistanceAdj, y=~H, name='Distance vs. Elevation', type='scatter', mode='lines+markers', text=~name)%>%
layout(title = siteID1, xaxis=xAxisTitle1, yaxis=yAxisTitle1)
